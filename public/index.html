<!DOCTYPE html>
<html lang="en">
  <head>
    <title>DoScroll</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="css/style.css">
    <!--Disable mobile zooming-->
    <meta content='width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;' name='viewport' />
    <meta name="viewport" content="width=device-width" />
  </head>
  <body>
    <header id="main-header">
      <h1>DoScroll</h1>
      <h2>A simple TODO app.</h2>
    </header>
    <div id="main-content">
      <div id="main-grid">
        <div id="top-left"></div>
        <div id="top-right"></div>
        <div id="bottom-left"></div>
        <div id="bottom-right"></div>
        <div id="center">Loading...</div>
      </div>
    </div>
    <footer id="main-footer">

    </footer>
    <form action="">
      <input type='text' id='yourname' value="your name here">
      <button>submit</button>
    </form>
  </body>
  <script>
    const submit = function( e ) {
      // prevent default form action from being carried out
      e.preventDefault()

      const input = document.querySelector( '#yourname' ),
            json = { yourname: input.value },
            body = JSON.stringify( json )

      fetch( '/submit', {
        method:'POST',
        body 
      })
      .then( function( response ) {
        // do something with the reponse 
        console.log( response )
      })

      return false
    }

    window.onload = function() {
      document.querySelector('button').onclick = submit;
      var data = {
        headers: ["Math","English","Science","History"],
        events: []
      };
      initializeGrid(data);
    }

    function initializeGrid(data){
      var grid = document.getElementById("main-grid");
      var loadingText = document.getElementById("center");
      loadingText.parentNode.removeChild(loadingText);

      //Initialize headers
      for(var i=0; i<data.headers.length; i++){
        var headerElement = document.createElement("div");
        headerElement.style.gridColumn = i+2; //+1 because they're 1-indexed, +1 because of the date column. A rare double off-by-one error correction!
        headerElement.style.gridRow = 1;
        headerElement.innerHTML = `<h2>${data.headers[i]}</h2>`;
        grid.appendChild(headerElement);
      }

      //Initialize dates
      data.events = data.events.sort((a,b)=>(a.date-b.date)); //Sort in ascending order of dates/times
      var startDate = data.events[0] ? data.events[0].date : new Date(Date.now());
      var endDate = data.events[data.events.length-1] ? data.events[data.events.length-1].date : new Date(Date.now());
      console.log(getFormattedDate(startDate));
      console.log(getFormattedDate(endDate));
      var dates = [new Date(startDate.getTime())]; //Clone startDate as the first date
      var curDate = new Date(startDate.getTime());
      for(var i=0; i<100; i++){
        curDate.setDate(curDate.getDate()+1); //Increment date by 1, accounting for months/timezones/etc.
        console.log(curDate.getTime());
        console.log(startDate.getTime());
        if((curDate > endDate) && (curDate.getTime() - startDate.getTime() > (7*24*60*60*1000))){ //Until endDate, min=7 days max=100 days
          break;
        }
        dates.push(new Date(curDate.getTime())); //Clone the next day and store it
      }
      console.log(dates);
    }

    function getFormattedDate(date){
      return date.toLocaleString('en-US', { month: 'long', day: 'numeric' });
    }
  </script>
</html>
